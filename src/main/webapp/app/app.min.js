var kissApp=angular.module("kissApp",["ui.router","smart-table","angularTreeview","ui.bootstrap","cfp.hotkeys","angular-cache"]);kissApp.constant("CACHE_STATE","true"),kissApp.service("globalData",function(){return{dataLoaded:!1}}),kissApp.controller("progressIndicator",function($scope,globalData){$scope.isDataLoaded=globalData,$scope.$watch("isDataLoaded.dataLoaded",function(newValue,oldValue,scope){console.log(scope+"oldValue"+oldValue+"newValue"+newValue+"scope"+scope)})}),kissApp.controller("parentController",["$scope","CustomerService","$state",function($scope,CustomerService,$state){$scope.jumpToSearchPage=function(){var results=CustomerService.getStreets($scope.searchTerm);void 0!=results.Address&&console.log("in result"),void 0!=results.Customer&&console.log("in customer")}}]),kissApp.run(function($http,CacheFactory){CacheFactory("defaultCache",{maxAge:9e5,cacheFlushInterval:6e6,deleteOnExpire:"aggressive"}),$http.defaults.cache=CacheFactory.get("defaultCache")}),kissApp.config(function($stateProvider,$urlRouterProvider,$httpProvider){$urlRouterProvider.otherwise("/ntlmCheck"),$stateProvider.state("ntlmCheck",{url:"/ntlmCheck",controller:"loginController"}).state("login",{url:"/login",templateUrl:"content/templates/login.html",controller:"loginController"}).state("home",{url:"/home",templateUrl:"content/templates/home.html"}).state("search",{url:"/search",templateUrl:"content/templates/search.html"}).state("search.customer",{url:"/customer",templateUrl:"content/templates/customer-search.html",controller:"customerSearchController"}).state("search.address",{url:"/address",templateUrl:"content/templates/popup-address.html",controller:"modalAddressInstanceCtrl"}).state("customer",{url:"customer/:cusNo",views:{"":{templateUrl:"content/templates/customer-details.html"},"cusTree@customer":{templateUrl:"content/templates/customer-tree.html",controller:"treeController"},"tabs@customer":{templateUrl:"content/templates/tabs.html",controller:"cutabController"}}}).state("customer.case",{url:"/case/:caseNo",views:{"":{templateUrl:"content/templates/customer-details.html"},"tabs@customer":{templateUrl:"content/templates/tabs.html",controller:"casetabController"}}}).state("address",{url:"/address/:cusNo",templateUrl:"content/templates/popup-address.html",controller:"modalAddressInstanceCtrl"})}),function(){angular.module("kissApp").controller("modalAddressInstanceCtrl",["$scope","$rootScope","AddressService","$stateParams","$state","CustomerService","$filter",function($scope,$rootScope,AddressService,$stateParams,$state,CustomerService,$filter){$scope.rowCollection=[],$scope.addressId=[],$scope.showAddress=!1,$scope.page=1,$scope.pageLoded,$scope.isLoading=!1,$scope.currentPage=0,$scope.valueForSearch="",$scope.custNo=$stateParams.cusNo,$scope.streetname=void 0,$scope.areFieldEmpty=!1,$scope.hideSearch=!1,$scope.getStreets=function(val){return CustomerService.getStreets(val)},null===$stateParams.cusNo||angular.isUndefined($stateParams.cusNo)?$scope.fromInstallations=!1:$scope.fromInstallations=!0,$scope.searchData=function(){var filtered=$scope.valueForSearch?$filter("filter")($scope.rowCollection,$scope.valueForSearch):$scope.rowCollection;$scope.displayedCollection=[].concat(filtered)},$scope.searchAgain=function(){$scope.hideSearch=!1},$scope.addSelected=function(){var addData={addressIds:$scope.addressId,cableUnitNumber:$scope.custNo};console.log(addData),AddressService.addInstallationsOnAddress(addData).then(function(result){$rootScope.infoMessage=result.description,"101"===result.code?$rootScope.displayingMsgType="success":$rootScope.displayingMsgType="failure",$rootScope.displayingMsgCode=result.code,$rootScope.displayingMsgContent=result.description,$state.go("customer",{cusNo:$scope.custNo})})},$scope.processForm=function(){$scope.isLoading=!0;var data={floor:$scope.floor,door:$scope.door,streetname:$scope.streetname};$scope.areFieldEmpty=!(""!=$scope.floor&&void 0!=$scope.floor||void 0!=$scope.door&&""!=$scope.door||""!=$scope.streetname&&void 0!=$scope.streetname),$scope.areFieldEmpty||AddressService.searchAddress(data,$scope.page).then(function(result){$scope.rowCollection=result.addresses,$scope.itemsByPage=result.totalPages,$scope.displayedCollection=[].concat($scope.rowCollection),$scope.showAddress=!0,$scope.isLoading=!1,$scope.hideSearch=!0})},$scope.selectPage=function(page){alert(page)},$scope.clear=function(){$scope.searchform.$setPristine()},$scope.getPaginatedData=function(tableState){(null!=tableState.sort.predicate||void 0!=tableState.sort.predicate)&&(0==tableState.pagination.start&&(tableState.pagination.start=$scope.currentPage),console.log("predicate"+tableState.sort.predicate),tableState.sort.predicate&&("streetname"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.streetname",tableState.sort.reverse):"streetcode"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.streetcode",tableState.sort.reverse):"municipalitycode"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.municipalities.municipalitycode",tableState.sort.reverse):"regionid"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.municipalities.regions.regionid",tableState.sort.reverse):"regionname"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.municipalities.regions.regionname",tableState.sort.reverse):"source"===tableState.sort.predicate?$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,"streets.source",tableState.sort.reverse):$scope.displayedCollection=$filter("orderBy")($scope.rowCollection,tableState.sort.predicate,tableState.sort.reverse))),tableState.pagination.numberOfPages=$scope.itemsByPage,console.log(tableState.pagination.start),$scope.currentPage!=tableState.pagination.start&&($scope.currentPage=tableState.pagination.start,$scope.page=tableState.pagination.start/10+1,$scope.processForm(),console.log("page number"+tableState.pagination.start),$scope.valueForSearch=""),$scope.$watch("itemsByPage",function(newValue,oldValue,scope){tableState.pagination.numberOfPages=scope.itemsByPage})}}])}(),function(){angular.module("kissApp").controller("customerSearchController",["$scope","CustomerService","$state","hotkeys",function($scope,CustomerService,$state,hotkeys){$scope.areFieldEmpty=!1,$scope.custNo=void 0,$scope.getCustomers=function(val){return CustomerService.getCustomers(val)},$scope.custoName=void 0,$scope.getCustomerNames=function(val){return CustomerService.getCustomerNames(val)},$scope.processForm=function(){$scope.areFieldEmpty=!1,$scope.areFieldEmpty=!(""!=$scope.custNo&&void 0!=$scope.custNo||void 0!=$scope.custoName&&""!=$scope.custoName),$scope.areFieldEmpty||$state.go("customer",{cusNo:$scope.custNo})},hotkeys.bindTo($scope).add({combo:"ctrl+f",description:"Search Customer",callback:function(event){event.preventDefault(),$scope.processForm()}}).add({combo:"ctrl+home",description:"Clear Form",callback:function(){$scope.clearForm()}}),$scope.clearForm=function(){$scope.custNo=void 0,$scope.custoName=void 0,$scope.areFieldEmpty=!1}}]),angular.module("kissApp").controller("addressSearchController",function($scope){$scope.message="Hello from Address Search"}),angular.module("kissApp").controller("cutabController",function($scope,$state,$stateParams,hotkeys){$scope.tabs=[{title:"Cable Unit Details",templateUrl:"content/templates/underDevelopment.html"},{title:"Installation",show:!0,templateUrl:"content/templates/installation.html"},{title:"Documents",templateUrl:"content/templates/underDevelopment.html"},{title:"Party Actors",templateUrl:"content/templates/underDevelopment.html"}],hotkeys.bindTo($scope).add({combo:"ctrl+b",description:"Hide/Show tree view",callback:function(event){$scope.hideTree()}}),$scope.hideTree=function(){$("#openButton").toggle(),$("#form_div").animate({width:"toggle"},200,function(){$("#closeButton").toggle()}),$("#wrapper").toggleClass("toggled")}}),angular.module("kissApp").controller("casetabController",function($scope,$state,$stateParams){$scope.tabs=[{title:"Agreements about Products",show:!0,templateUrl:"content/templates/underDevelopment.html"},{title:"CaseWorkFlow",templateUrl:"content/templates/underDevelopment.html"},{title:"Document Templates",templateUrl:"content/templates/underDevelopment.html"},{title:"Addresses",templateUrl:"content/templates/underDevelopment.html"}]}),angular.module("kissApp").controller("treeController",["$scope","$stateParams","CustomerService",function($scope,$stateParams,CustomerService){$scope.init=function(){console.log("$stateParams.cusNo"+$stateParams.cusNo),CustomerService.getCustomerTree($stateParams.cusNo).then(function(result){$scope.roleList=[result],$scope.isLoading=!1})}}]),angular.module("kissApp").controller("instController",["$scope","$rootScope","$stateParams","$filter","$modal","CustomerService","DroolsService",function($scope,$rootScope,$stateParams,$filter,$modal,CustomerService,DroolsService){$scope.drools=[],$scope.isLoading=!0,$scope.rowCollection=[],$scope.custNo=$stateParams.cusNo,$scope.page=1,$scope.currentPage=0,$scope.init=!0,$scope.showCol=!1,$scope.displayingMsgType=$rootScope.displayingMsgType,$scope.displayingMsgCode=$rootScope.displayingMsgCode,$scope.displayingMsgContent=$rootScope.displayingMsgContent,$rootScope.displayingMsgType=void 0,$rootScope.displayingMsgCode=void 0,$rootScope.displayingMsgContent=void 0,$scope.options=[{label:"Stik Opsat",value:"Stik Opsat"},{label:"Fordelerboks Opsat",value:"Fordelerboks Opsat"},{label:"ikke Opdateret",value:"ikke Opdateret"}],$scope.statusSelected=$scope.options[0],$scope.getIndtallations=function(tableState){(null!=tableState.sort.predicate||void 0!=tableState.sort.predicate)&&(0==tableState.pagination.start&&(tableState.pagination.start=$scope.currentPage),console.log("predicate"+tableState.sort.predicate),tableState.sort.predicate&&($scope.displayed=$filter("orderBy")($scope.rowCollection.installations,tableState.sort.predicate,tableState.sort.reverse))),tableState.pagination.numberOfPages=$scope.itemsByPage,(1==$scope.init||$scope.currentPage!=tableState.pagination.start)&&($scope.isLoading=!0,$scope.currentPage=tableState.pagination.start,$scope.page=tableState.pagination.start/10+1,$scope.valueForSearch="",CustomerService.getInstallations($stateParams.cusNo,$scope.page).then(function(result){$scope.rowCollection=result,$scope.itemsByPage=$scope.rowCollection.totalPages,$scope.displayed=[].concat($scope.rowCollection.installations),$scope.isLoading=!1,$scope.init=!1,tableState.pagination.numberOfPages=$scope.itemsByPage,DroolsService.getBusinessRules().then(function(droolsResponse){$scope.drools=droolsResponse}),$scope.oldCollection=angular.copy($scope.rowCollection)}))},$scope.searchData=function(){var filtered=$scope.valueForSearch?$filter("filter")($scope.rowCollection.installations,$scope.valueForSearch):$scope.rowCollection.installations;$scope.displayed=[].concat(filtered)},$scope.isUndefined=function(data){return"undefined"==typeof data},$scope.$watch("tabs",function(oldValue,newValue){alert("tab changed"),angular.equals($scope.oldCollection,$scope.rowCollection)&&alert("collection saved")},!0),$scope.$on("$destroy",function(){alert("route changed")})}])}(),function(){angular.module("kissApp").controller("loginController",["$scope","$rootScope","LoginService","$state",function($scope,$rootScope,LoginService,$state){LoginService.autoLogin().then(function(response){console.log(response),$rootScope.authenticated?$state.go("login"):$state.go("home")}),$scope.authenticate=function(){var username=$scope.username,password=$scope.password;LoginService.authenticate(username,password).then(function(data){console.log(data),$rootScope.authenticated?$state.go("home"):$state.go("login")})}}])}(),kissApp.directive("myTabs",[function(){return{restrict:"AE",scope:!1,templateUrl:"content/templates/myTabs.html",link:function(scope,element,attrs){scope.tabs=scope.$eval(attrs.tabs),scope.setActiveTab=function(title){for(var i=0;i<scope.tabs.length;i++)scope.tabs[i].show=!1,scope.tabs[i].title===title&&(scope.tabs[i].show=!0)}}}}]).directive("staticInclude",["$http","$templateCache","$compile",function($http,$templateCache,$compile){return function(scope,element,attrs){var templatePath=attrs.staticInclude;$http.get(templatePath,{cache:$templateCache}).success(function(response){var contents=element.html(response).contents();$compile(contents)(scope)})}}]),kissApp.directive("csSelect",function(){return{require:"^stTable",template:"",scope:{row:"=csSelect"},link:function(scope,element,attr,ctrl){element.bind("change",function(evt){scope.$apply(function(){ctrl.select(scope.row,"multiple")})}),scope.$watch("row.isSelected",function(newValue,oldValue){if(newValue===!0)element.parent().addClass("st-selected"),scope.$parent.addressId.push(scope.row.id.addressId);else{element.parent().removeClass("st-selected");var index=scope.$parent.addressId.indexOf(scope.row.id.addressId);index>-1&&scope.$parent.addressId.splice(index,1)}})}}}),kissApp.directive("stRatio",function(){return{link:function(scope,element,attr){var ratio=+attr.stRatio;element.css("width",ratio+"%")}}}),kissApp.directive("pageSelect",function(){return{restrict:"E",template:'<input type="text" class="select-page" ng-model="inputPage" ng-change="selectPage(inputPage)">',link:function(scope,element,attrs){scope.$watch("currentPage",function(c){scope.inputPage=c})}}}),kissApp.directive("droolsCheck",function(){function link($scope,element,attributes){var droolsArray=attributes.droolsCheck,droolsConstraintId=attributes.droolsConstraint;$scope.$watch(droolsArray,function(droolsNewValue,droolsOldValue){droolsNewValue!=droolsOldValue&&droolsNewValue.enableFields.indexOf(droolsConstraintId)>-1&&element.prop("disabled",!1)})}return{link:link,restrict:"A"}}),kissApp.service("AddressService",["$http"," $q","globalData",function($http,$q,globalData){this.getInstallationsOnAddress=function(cusNo){var d=$q.defer();return $http.get("/kiss-rest/installations/"+cusNo).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise},this.addInstallationsOnAddress=function(addData){var d=$q.defer();return globalData.dataLoaded=!0,$http.post("/kiss-rest/installations/createInstallations",addData).success(function(data,status,headers,config){d.resolve(data),console.log("addition"+data),globalData.dataLoaded=!1}).error(function(data,status,headers,config){d.reject()}),d.promise},this.searchAddress=function(postData,page){var d=$q.defer();return globalData.dataLoaded=!0,$http.post("/kiss-rest/ams/addresses/search/?pageNo="+page,postData).success(function(data,status,headers,config){d.resolve(data),console.log(data),globalData.dataLoaded=!1}).error(function(data,status,headers,config){d.reject()}),d.promise}}]),kissApp.service("LoginService",["$http","$q","$rootScope",function($http,$q,$rootScope){this.autoLogin=function(){var d=$q.defer();return $http.get("/kiss-rest/ntlmCheckLogin").success(function(data,status,headers,config){d.resolve(response)}).error(function(data,status,headers,config){404==status&&null!=headers()["x-k2ui-userid"]?(d.resolve("loginSuccess"),$rootScope.authenticated=!0):($rootScope.authenticated=!1,d.reject())}),d.promise},this.authenticate=function(username,password){var d=$q.defer();return $http.post("/kiss-rest/authenticate/login",{username:username,password:password}).success(function(data,status,headers,config){$rootScope.authenticated=!0,d.resolve(data)}).error(function(data,status,headers,config){$rootScope.authenticated=!1,d.reject()}),d.promise}}]),kissApp.service("CustomerService",["$http","$q","globalData","CACHE_STATE",function($http,$q,globalData,CACHE_STATE){this.getInstallations=function(cusNo,page){var d=$q.defer();return console.log("cusNo"+cusNo),globalData.dataLoaded=!0,$http.get("/kiss-rest/installations/"+cusNo+"/?pageNo="+page,{cache:!0}).success(function(response){d.resolve(response),console.log("success"+response),globalData.dataLoaded=!1,d.resolve(response)}).error(function(){d.reject()}),d.promise},this.getCustomerTree=function(cusNo){var d=$q.defer();return console.log("cusNo service"+cusNo),$http.get("/kiss-rest/cableunit/cu/"+cusNo,{cache:CACHE_STATE}).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise},this.getCustomers=function(cuNum){var d=$q.defer();return $http.get("/kiss-rest/cableunit/cus/"+cuNum).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise},this.getCustomerNames=function(cuNum){var d=$q.defer();return $http.get("/kiss-rest/cableunit/search/cus/"+cuNum).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise},this.getStreets=function(streetName){var d=$q.defer();return $http.get("/kiss-rest/ams/street/search/"+streetName).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise}}]),kissApp.service("CustomerTreeService",["$http","$q",function($http,$q){this.getCustomerTree=function(cusNo){var d=$q.defer();return console.log("cusNo"+cusNo),$http.get("/rest/installations/"+cusNo).success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise}}]),kissApp.service("DroolsService",["$http","$q",function($http,$q,globalData){this.getBusinessRules=function(){var d=$q.defer();return $http.get("/kiss-rest/drools/authorize").success(function(response){d.resolve(response)}).error(function(){d.reject()}),d.promise}}]);